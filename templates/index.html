<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KippInsights</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>


<body>
    
    <h1>KippInsights</h1>
    <hr>


    <div class="control_buttons">
        

        <h2>Action 1</h2>
        <hr>
        
        <!-- Dropdown Form -->
        <form method="POST" action="/">
            <label for="action_type">Select action type:</label>
            <select name="action_type" id="action_type">
                <option value="pass">Pass</option>
                <option value="shot">Shot</option>
                <option value="dribble">Dribble</option>
            </select>

            
            <!-- Hidden inputs to store coordinates -->
            <input type="hidden" id="x_start" name="x_start">
            <input type="hidden" id="y_start" name="y_start">
            <input type="hidden" id="x_end" name="x_end">
            <input type="hidden" id="y_end" name="y_end">

            <button type="submit">Save Event</button>

            
        </form>

        <hr>

        <h3>Action Details:</h3>

        {% if type == 'pass' %}
        <p>Type: {{type}}</p>
        <!--<p>Player: {{player}}</p>-->
        <p>Start location: {{x_start_coordinate}},{{y_start_coordinate}}</p>
        <p>End location: {{x_end_coordinate}},{{y_end_coordinate}}</p>
    
        <!--{% if successful == True %}
        <p class="status successful">Complete</p>
        {% else %}
        <p class="status unsuccessful">Incomplete</p>
        {% endif %}-->
        
        {% endif %}

        

        {% if type == 'shot' %}
        <p>Type: {{type}}</p>
        <!--<p>Player: {{player}}</p>-->
        <p>Shot location: {{shot_x_coordinate}},{{shot_y_coordinate}}</p>
        
        <!--{% if successful == True %}
        <p class="status successful">Complete</p>
        {% else %}
        <p class="status unsuccessful">Incomplete</p>
        {% endif %}-->
        
        {% endif %}

        {% if type == 'dribble' %}
        <p>Type: {{type}}</p>
        <!--<p>Player: {{player}}</p>-->
        <p>Start location: {{x_start_coordinate}},{{y_start_coordinate}}</p>
        <p>End location: {{x_end_coordinate}},{{y_end_coordinate}}</p>
        {% if successful == True %}
        <!--<p class="status successful">Complete</p>
        {% else %}
        <p class="status unsuccessful">Incomplete</p>
        {% endif %}-->

        {% endif %}


    </div>
    
    <div class="pitch_box">
        <h2>Action Map</h2>

        <svg id="pitch" width="920" height="592" style="border:1px solid #000; cursor:pointer;">
            <!-- Pitch background -->
            
            <!-- Halfway line -->
            <line x1="460" y1="0" x2="460" y2="592" stroke="white" stroke-width="2"/>
        
            <!-- Center circle -->
            <circle cx="460" cy="296" r="80" fill="none" stroke="white" stroke-width="2"/>

            <!-- Center spot -->
            <circle cx="460" cy="296" r="3" fill="white" stroke="white" stroke-width="2"/>

            <!-- Left penalty area -->
            <rect x="0" y="120" width="144" height="352" fill="none" stroke="white" stroke-width="2"/>

            <!-- Left six yard box -->
            <rect x="0" y="206" width="48" height="180" fill="none" stroke="white" stroke-width="2"/>

            <!-- Left penalty spot-->
            <circle cx="84" cy="296" r="3" fill="white" stroke="white" stroke-width="2"/>

            <!-- Right penalty area -->
            <rect x="776" y="120" width="144" height="352" fill="none" stroke="white" stroke-width="2"/>
            
            <!-- right six yard box -->
            <rect x="872" y="206" width="48" height="180" fill="none" stroke="white" stroke-width="2"/>

            <!-- Left penalty spot-->
            <circle cx="836" cy="296" r="3" fill="white" stroke="white" stroke-width="2"/>
            
        </svg>
    </div>

</body>
</html>

<script>
const pitch = document.getElementById("pitch");
const pitchWidth = pitch.clientWidth;   // 920
const pitchHeight = pitch.clientHeight; // 592

let clicks = 0;
let startMarker, endMarker, line;

pitch.addEventListener("click", function(event) {
    const rect = pitch.getBoundingClientRect();

    // Raw pixel coordinates
    const x = event.clientX - rect.left;
    const y = event.clientY - rect.top;

    // Normalize between 0 and 1
    const normX = (x / pitchWidth).toFixed(4); // round to 4 decimal places
    const normY = (y / pitchHeight).toFixed(4);

    if (clicks === 0) {
        if (startMarker) pitch.removeChild(startMarker);
        if (endMarker) pitch.removeChild(endMarker);
        if (line) pitch.removeChild(line);

        // Draw start marker (use raw pixels for display)
        startMarker = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startMarker.setAttribute("cx", x);
        startMarker.setAttribute("cy", y);
        startMarker.setAttribute("r", 6);
        startMarker.setAttribute("fill", "green");
        pitch.appendChild(startMarker);

        // Store normalized coordinates
        document.getElementById("x_start").value = normX;
        document.getElementById("y_start").value = normY;

        clicks = 1;
    } else if (clicks === 1) {
        endMarker = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        endMarker.setAttribute("cx", x);
        endMarker.setAttribute("cy", y);
        endMarker.setAttribute("r", 6);
        endMarker.setAttribute("fill", "red");
        pitch.appendChild(endMarker);

        // Draw line using raw pixels for display
        line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", startMarker.getAttribute("cx"));
        line.setAttribute("y1", startMarker.getAttribute("cy"));
        line.setAttribute("x2", x);
        line.setAttribute("y2", y);
        line.setAttribute("stroke", "yellow");
        line.setAttribute("stroke-width", "2");
        pitch.appendChild(line);

        // Store normalized end coordinates
        document.getElementById("x_end").value = normX;
        document.getElementById("y_end").value = normY;

        clicks = 0;
    }
});

    </script>
    